# encoding: utf-8
# This file is distributed under New Relic's license terms.
# See https://github.com/newrelic/rpm/blob/master/LICENSE for complete details.

files = <<-EOF
[ruby -w -I"lib:/Users/mlang/projects/agents/ruby/ruby_agent/test:/Users/mlang/projects/agents/ruby/ruby_agent/lib" -I"/Users/mlang/.rvm/gems/ruby-2.6.3/gems/rake-12.3.3/lib" "/Users/mlang/.rvm/gems/ruby-2.6.3/gems/rake-12.3.3/lib/rake/rake_test_loader.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/adaptive_sampler_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/agent/connect_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/agent/start_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/agent/start_worker_thread_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/agent_logger_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/agent_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/apdex_from_server_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/api_tests/datastore_api_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/attribute_filter_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/attribute_processing_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/audit_logger_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/autostart_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/collector_hostname_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/collector_response_code_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/commands/agent_command_router_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/commands/agent_command_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/commands/thread_profiler_session_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/configuration/default_source_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/configuration/dotted_hash_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/configuration/environment_source_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/configuration/event_harvest_config_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/configuration/high_security_source_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/configuration/manager_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/configuration/manual_source_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/configuration/orphan_configuration_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/configuration/security_policy_source_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/configuration/server_source_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/configuration/yaml_source_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/connect/request_builder_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/connect/response_handler_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/custom_event_aggregator_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/database/postgres_explain_obfuscator_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/database/sql_obfuscation_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/database_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/datastores/metric_helper_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/datastores/mongo/event_formatter_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/datastores/mongo/metric_translator_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/datastores/mongo/obfuscator_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/datastores/mongo/statement_formatter_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/datastores/redis_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/datastores_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/deprecator_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/distributed_tracing/distributed_trace_metrics_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/distributed_tracing/distributed_trace_payload_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/distributed_tracing/distributed_tracing_cross_agent_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/distributed_tracing/trace_context_cross_agent_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/distributed_tracing/trace_context_header_data_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/distributed_tracing/trace_context_payload_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/distributed_tracing/trace_context_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/distributed_tracing_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/encoding_normalizer_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/error_collector_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/error_event_aggregator_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/error_trace_aggregator_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/event_aggregator_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/event_listener_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/event_loop_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/external_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/guid_generator_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/harvester_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/heap_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/hostname_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/http_clients/uri_util_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/instrumentation/action_cable_subscriber_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/instrumentation/action_controller_subscriber_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/instrumentation/action_view_subscriber_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/instrumentation/active_job_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/instrumentation/active_record_helper_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/instrumentation/active_record_subscriber_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/instrumentation/active_storage_subscriber_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/instrumentation/controller_instrumentation_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/instrumentation/delayed_job_instrumentation_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/instrumentation/instance_identification_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/instrumentation/instrumentation_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/instrumentation/middleware_proxy_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/instrumentation/middleware_tracing_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/instrumentation/mongodb_command_subscriber_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/instrumentation/net_instrumentation_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/instrumentation/queue_time_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/instrumentation/rack_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/instrumentation/sequel_helper_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/instrumentation/sinatra/transaction_namer_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/instrumentation/sinatra_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/instrumentation/task_instrumentation_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/javascript_instrumentor_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/logging_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/memory_logger_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/messaging_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/method_interrobang_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/method_tracer/class_methods/add_method_tracer_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/method_tracer/instance_methods/trace_execution_scoped_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/method_tracer_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/method_visibility_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/monitors/cross_app_monitor_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/monitors/distributed_trace_monitor_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/monitors/distributed_tracing_monitor_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/monitors/inbound_request_monitor_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/monitors/synthetics_monitor_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/monitors/trace_context_request_monitor_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/new_relic_service/json_marshaller_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/new_relic_service/security_policy_settings_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/new_relic_service_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/obfuscator_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/parameter_filtering_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/payload_metric_mapping_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/pipe_channel_manager_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/pipe_service_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/priority_sampled_buffer_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/range_extensions_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/rpm_agent_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/rules_engine_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/sampler_collection_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/sampler_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/samplers/cpu_sampler_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/samplers/memory_sampler_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/samplers/vm_sampler_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/span_event_aggregator_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/span_event_primitive_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/span_events_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/sql_sampler_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/stats_engine/gc_profiler_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/stats_engine/stats_hash_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/stats_engine_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/stats_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/supportability_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/synthetics_event_aggregator_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/system_info_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/threading/agent_thread_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/threading/backtrace_node_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/threading/backtrace_service_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/threading/thread_profile_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/tracer_state_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/tracer_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/transaction/abstract_segment_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/transaction/attributes_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/transaction/datastore_segment_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/transaction/distributed_tracer_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/transaction/distributed_tracing_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/transaction/external_request_segment_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/transaction/message_broker_segment_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/transaction/request_attributes_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/transaction/segment_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/transaction/slowest_sample_buffer_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/transaction/synthetics_sample_buffer_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/transaction/trace_builder_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/transaction/trace_context_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/transaction/trace_node_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/transaction/trace_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/transaction/tracing_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/transaction_error_primitive_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/transaction_event_aggregator_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/transaction_event_primitive_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/transaction_event_recorder_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/transaction_interrobang_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/transaction_metrics_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/transaction_sampler_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/transaction_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/transaction_time_aggregator_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/utilization/aws_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/utilization/azure_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/utilization/gcp_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/utilization/pcf_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/utilization/vendor_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/utilization_data_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/vm/monotonic_gc_profiler_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/vm/mri_vm_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/vm/snapshot_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/vm_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent/worker_loop_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/agent_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/cli/commands/deployments_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/cli/commands/install_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/coerce_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/collection_helper_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/control/class_methods_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/control/frameworks/rails_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/control/instance_methods_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/control/instrumentation_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/control_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/dependency_detection_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/dispatcher_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/environment_report_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/framework_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/language_support_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/latest_changes_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/license_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/load_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/local_environment_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/metric_data_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/metric_spec_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/noticed_error_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/rack/agent_hooks_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/rack/agent_middleware_test.rb" "/Users/mlang/projects/agents/ruby/ruby_agent/test/new_relic/rack/browser_monitoring_test.rb" -v --seed=43417]
EOF

CMD = %{TESTOPTS="-v --seed=43417" bundle exec rake test file=%s}

file_list = files.scan(/\s\"\/Users\/mlang\/projects\/agents\/ruby\/ruby_agent\/(test\/[^\"]*)\"/).flatten

def verbose?
  true
end

def log msg
  print msg if verbose?
end

def failing? files
  puts "looking at #{files.size} files..."
  cmd = CMD % files.join(",")
  puts cmd
  result = IO.popen(cmd, err: [:child, :out]) do |io|
    until io.eof do
      log io.read(1)
    end
  end
  !$?.to_i.zero?
end


head = 0
tail = file_list.size - 1

# jumpstart the re-analysis when advancing head and tail here!  comment out otherwise
# head = 26
# tail = 40

if tail == file_list.size - 1
  puts "finding the tail..."
  while tail > head && failing?(file_list.slice(head..tail)) do tail -= 10; end
  while tail < file_list.size && !failing?(file_list.slice(head..tail)) do tail += 1; end
  puts "tail is: #{tail}"
end

if head.zero?
  puts "finding the head..."
  while head < tail && failing?(file_list.slice(head..tail)) do head += 10; end
  while head > 0 && !failing?(file_list.slice(head..tail)) do head -= 1; end
  puts "head is: #{head}"
  puts "tail is: #{tail}"
end

short_file_list = file_list.slice(head..tail)
if !failing?(short_file_list)
  raise "something wrong!"
end

p = 1
until p > short_file_list.size - 1 do
  even_shorter_file_list = short_file_list.dup
  even_shorter_file_list.delete_at(p)
  if failing? even_shorter_file_list
    short_file_list = even_shorter_file_list
  else
    p += 1
  end
end

puts "total files: #{short_file_list.size}"

puts
puts CMD % short_file_list.join(",")