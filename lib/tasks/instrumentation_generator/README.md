# Instrumentation Generator

## Idea
Create a CLI, similar to Railsâ€™ generators and scaffold scripts, to create the required files and basic classes for instrumenting new libraries. The hope is that the parts of adding new instrumentation that is repetitive can be eliminated and/or reduced so that it takes less time to add new instrumentation and we can spend development time considering the best attributes to collect and interactions to measure. I also hope this project will reduce the overall toil related to adding new instrumentation.

The files we create with little variation besides library and method names are:
* Lib
  * Dependency detection
  * Chain
  * Prepend
  * Instrumentation
* Tests
  * configuration/newrelic.yml
  * Envfile
  * Test file

Furthermore, we also create very similar snippets inside the default source configuration file that could be generated by this project as well.

## Outcome
A prototype outside the agent has been created that generates the required files to create new instrumentation. This prototype accepts three arguments: name (name of the library), method (method to instrument), args (arguments for the method).

The Ruby gem Thor, a toolkit for building powerful command-line interfaces used in Bundler, Vagrant, Rails and others powers this CLI.

## Usage

`thor list` can be passed to get a list of all available thor commands

### instrumentation:scaffold
This task requires one parameter by default: the name of the library or class you are instrumenting. This task generates the basic file structure needed to add new instrumentation to the Ruby agent.

It accepts two optional parameters:
* `--method`: the name of a method to instrument. Only one method can be accepted at this time. Defaults to `method_to_instrument`
* `--args`: the arguments for the instrumented method. A comma-separated list can be given if there are multiple arguments. Defaults to `*args`.

### WIP: instrumentation:add_new_method
This task inserts a new method existing piece of instrumentation. It requires one argument, the name of the existing instrumentation to add the method to. If the instrumented library does not already exist, it will create a new scaffold for that library.

It accepts two optional paramters:
* `--method`: the name of a method to instrument. Only one method can be accepted at this time. Defaults to `method_to_instrument`
* `--args`: the arguments for the instrumented method. A comma-separated list can be given if there are multiple arguments. Defaults to `*args`.


